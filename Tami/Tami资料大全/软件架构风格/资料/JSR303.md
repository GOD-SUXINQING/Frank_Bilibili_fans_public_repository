

### JSR-303

JSR是***Java Specification Requests***的缩写，意思是Java 规范提案。是指向[JCP](https://link.jianshu.com?t=http%3A%2F%2Fbaike.baidu.com%2Fview%2F148425.htm)(***Java Community Process***)提出新增一个标准化技术规范的正式请求。任何人都可以提交JSR，以向Java平台增添新的API和服务。JSR已成为Java界的一个重要标准。

------

JSR-303 是JAVA EE 6 中的一项子规范，叫做Bean Validation，Hibernate Validator 是 Bean Validation 的参考实现 . Hibernate Validator 提供了 JSR 303 规范中所有内置 constraint 的实现，除此之外还有一些附加的 constraint。



**Bean Validation 中内置的 constraint**

| **Constraint**                | **详细信息**                                             |
| ----------------------------- | -------------------------------------------------------- |
| `@Null`                       | 被注释的元素必须为 `null`                                |
| `@NotNull`                    | 被注释的元素必须不为 `null`                              |
| `@AssertTrue`                 | 被注释的元素必须为 `true`                                |
| `@AssertFalse`                | 被注释的元素必须为 `false`                               |
| `@Min(value)`                 | 被注释的元素必须是一个数字，其值必须大于等于指定的最小值 |
| `@Max(value)`                 | 被注释的元素必须是一个数字，其值必须小于等于指定的最大值 |
| `@DecimalMin(value)`          | 被注释的元素必须是一个数字，其值必须大于等于指定的最小值 |
| `@DecimalMax(value)`          | 被注释的元素必须是一个数字，其值必须小于等于指定的最大值 |
| `@Size(max, min)`             | 被注释的元素的大小必须在指定的范围内                     |
| `@Digits (integer, fraction)` | 被注释的元素必须是一个数字，其值必须在可接受的范围内     |
| `@Past`                       | 被注释的元素必须是一个过去的日期                         |
| `@Future`                     | 被注释的元素必须是一个将来的日期                         |
| `@Pattern(value)`             | 被注释的元素必须符合指定的正则表达式                     |



***Hibernate Validator 附加的 constraint***

| **Constraint** | **详细信息**                           |
| :------------- | :------------------------------------- |
| `@Email`       | 被注释的元素必须是电子邮箱地址         |
| `@Length`      | 被注释的字符串的大小必须在指定的范围内 |
| `@NotEmpty`    | 被注释的字符串的必须非空               |
| `@Range`       | 被注释的元素必须在合适的范围内         |

在JavaEE环境中添加依赖

```xml
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
    <version>6.1.5.Final</version>
</dependency>
```

***注意报异常一***

```java
java.lang.IllegalStateException: No WebApplicationContext found: not in a DispatcherServlet request and no ContextLoaderListener registered?
```

原因：在页面中,使用spring表单标签中的属性modelAttribute="user"，在页面被加载时，由于没有初始化user对象，所以会报错

解决：在加载这个页面时，经过控制器方法参数设置：

```java
public String get(@ModelAttribute("user") User user){
        return "index";
}
```

经过这个控制器跳转后,就可以解决。

***注意报异常二***

```java
java.lang.IllegalStateException: Neither BindingResult nor plain target object for bean name 'command' available as request attribute
```

原因：在页面中使用spring的表单标签，指定了path的属性值，但是没有指定modelAttribute

```html
<form:form action="${pageContext.request.contextPath}/user/validate" method="post">
    <form:input path="id" id="编号"  /><form:errors path="id" cssStyle="color:#ff0048"/> <br/>
    <form:input path="name" id="姓名"/><br/>
    <input type="submit" value="提交"/>
</form:form>
```

解决方法:添加modelAttribute

```html
<form:form action="${pageContext.request.contextPath}/user/validate" method="post" modelAttribute="user" >
    <form:input path="id" id="编号"  /><form:errors path="id" cssStyle="color:#ff0048"/> <br/>
    <form:input path="name" id="姓名"/><br/>
    <input type="submit" value="提交"/>
</form:form>
```



***总结***



- 使用spring的表单标签进行数据绑定和使用JSR303验证框架，如果要在表单中使用modelAttribute属性

  ```html
  <form:form action="${pageContext.request.contextPath}/user/validate" method="post" modelAttribute="user" >
      <form:input path="id" id="编号"  /><form:errors path="id" cssStyle="color:#ff0048"/> <br/>
      <form:input path="name" id="姓名"/><br/>
      <input type="submit" value="提交"/>
  </form:form>
  ```

  一定要在Java代码中(一般在控制器中)设置@ModelAttribute		

  ```java
  //设置@ModelAttribute,进行页面跳转,避免异常一的出现
  @RequestMapping("/useradd.html")
  public String useradd(@ModelAttribute User user){
      return "useradd";
  }
  ```

  表单校验需要设置：

  - 实体类设置注解(验证方式):参考***Bean Validation 中内置的 constraint***

  ```java
  public class User implements Serializable {
      @NotNull(message = "编号不能为空!")
      private Integer id;
      private String name;
      @DateTimeFormat(pattern = "yyyy-MM-dd")
      private Date birthday;
  }
  ```

  - 在控制器设置注解,进行验证

    @Valid,然后紧跟其后设置BindingResult参数，使用方式如下

  ```java
  @RequestMapping("/validate")
  public String validate(@Valid User user, BindingResult br){
      if(br.hasErrors()){//校验有错误
          return "index";
      }
      return "redirect:/index.jsp";
  }
  ```

  - 使用modelAttribute属性和@ModelAttribute注解的目的:
    - 实现数据绑定（回显）
    - 实现表单的校验

  ```java
  <form:errors path="id" cssStyle="color:#ff0048"/>
  ```

  

